{% if fichas %}
<div class="card overflow-hidden">
  <table class="min-w-full divide-y divide-slate-200 text-sm">
    <thead class="bg-slate-50 text-left">
      <tr>
        <th class="px-4 py-3">Processo</th>
        <th class="px-4 py-3">Template</th>
        <th class="px-4 py-3">Indexador</th>
        <th class="px-4 py-3">Criado</th>
        <th class="px-4 py-3"></th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-100 bg-white">
      {% for ficha in fichas %}
      <tr>
        <td class="px-4 py-3 font-medium">{{ process_label(ficha.process) }}</td>
        <td class="px-4 py-3">{{ ficha.template.nome }}</td>
        <td class="px-4 py-3">{{ ficha.indexador or '-' }}</td>
        <td class="px-4 py-3">{{ ficha.created_at|format_datetime }}</td>
        <td class="px-4 py-3 text-right">
          <div class="flex items-center justify-end gap-2">
            <a class="btn-secondary" href="/fichas/{{ ficha.id }}">Abrir</a>
            <a class="btn-secondary" href="/fichas/{{ ficha.id }}/editar">Editar</a>
            <form method="post" action="/fichas/{{ ficha.id }}/excluir" onsubmit="return confirm('Excluir esta ficha?');">
              <button class="btn-danger" type="submit">Excluir</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="card p-6 text-sm text-slate-600">Nenhuma ficha encontrada.</div>
{% endif %}

<div class="mt-4 flex items-center justify-between text-sm">
  <div class="text-slate-600">Mostrando {{ pagination.start }}-{{ pagination.end }} de {{ pagination.total }}</div>
  <div class="flex items-center gap-2">
    {% if pagination.has_prev %}
    <a
      class="btn-secondary"
      href="?{{ build_query(request.query_params, page=pagination.page-1) }}"
      hx-get="?{{ build_query(request.query_params, page=pagination.page-1) }}"
      hx-target="#ficha-list"
      hx-push-url="true"
    >Anterior</a>
    {% else %}
    <span class="btn-secondary opacity-50">Anterior</span>
    {% endif %}
    <span class="px-3 text-slate-500">Pagina {{ pagination.page }} de {{ pagination.pages }}</span>
    {% if pagination.has_next %}
    <a
      class="btn-secondary"
      href="?{{ build_query(request.query_params, page=pagination.page+1) }}"
      hx-get="?{{ build_query(request.query_params, page=pagination.page+1) }}"
      hx-target="#ficha-list"
      hx-push-url="true"
    >Proxima</a>
    {% else %}
    <span class="btn-secondary opacity-50">Proxima</span>
    {% endif %}
  </div>
</div>
